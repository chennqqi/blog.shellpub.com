<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="XMLDecoderè§£ææµç¨‹åˆ†æ">
  <meta name="generator" content="Hugo 0.37.1" />

  <title>XMLDecoderè§£ææµç¨‹åˆ†æ &middot; SHELLPUB BLOG</title>

  
  

  <link rel="stylesheet" href="//lib.baomitu.com/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//lib.baomitu.com/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//lib.baomitu.com/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="/css/custom.css">
    
  
  
    
        <script src="/js/baidu.js"></script>
    
  
    
        <script src="/js/baidupush.js"></script>
    
  
    
        <script src="/js/cnzz.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">SHELLPUB</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-home fa-fw'></i>HOME</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>POSTS</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/bug/"><i class='fa fa-bug fa-fw'></i>BUG</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>CONTACT</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.shellpub.com"><i class='fa fa-globe fa-fw'></i>å®˜ç½‘</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://n.shellpub.com"><i class='fa fa-chrome fa-fw'></i>åœ¨çº¿æŸ¥æ€</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>ABOUT</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://weibo.com/chennqqi" target="_blank"><i class="fa fa-weibo fa-fw"></i>Weibo</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/webshellpub" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>XMLDecoderè§£ææµç¨‹åˆ†æ</h1>
  <h2>XMLDecoderè§£ææµç¨‹åˆ†æ</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2019-05-07 22:18</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="topics/cve">CVE</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="topics/rce">RCE</a>
    
  </div>
  
  

  
  
  
  


	<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="·ÖÏíµ½Î¢ĞÅ"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="·ÖÏíµ½ĞÂÀËÎ¢²©"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="·ÖÏíµ½ÓĞµÀÔÆ±Ê¼Ç"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="·ÖÏíµ½QQ¿Õ¼ä"></a><a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="·ÖÏíµ½Ó¡Ïó±Ê¼Ç"></a></div>
	<script>window._bd_share_config={"common":{"bdSnsKey":{"tsina":"11640679"},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="tags/cve-2019-2725">CVE-2019-2725</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="tags/cve-2019-2725">CVE-2019-2725</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="tags/cve-2017-3506">CVE-2017-3506</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="tags/cve-2017-10352">CVE-2017-10352</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="tags/rce">RCE</a>
    
  </div>
  
  

</div>

  

<h1 id="xmldecoderè§£ææµç¨‹åˆ†æ">XMLDecoderè§£ææµç¨‹åˆ†æ</h1>

<h2 id="å‰è¨€">å‰è¨€</h2>

<p>ç»è¿‡äº†Weblogicçš„å‡ ä¸ªXMLDecoderç›¸å…³çš„CVE(CVE-2017-3506ã€CVE-2017-10352ã€CVE-2019-2725)ï¼Œå¥½å¥½çœ‹äº†ä¸€ä¸‹XMLDecoderçš„åˆ†ææµç¨‹ã€‚</p>

<p><strong>æœ¬æ–‡ä»¥jdk7ç‰ˆæœ¬çš„XMLDecoderè¿›è¡Œåˆ†æ,jdk6çš„XMLDecoderæµç¨‹éƒ½å†™åœ¨äº†ä¸€ä¸ªç±»é‡Œé¢ï¼ˆcom.sun.beans.ObjectHandlerï¼‰</strong></p>

<p>æ­¤å¤„åªåˆ†æXMLDecoderçš„è§£ææµç¨‹ï¼Œå…·ä½“Weblogicçš„æ¼æ´è¯·çœ‹å…¶å®ƒå‡ ä½å¸ˆå‚…å†™çš„Paperã€‚</p>

<p><a href="https://paper.seebug.org/909/">WebLogic RCE(CVE-2019-2725)æ¼æ´ä¹‹æ—…-Badcode</a></p>

<p><a href="https://mp.weixin.qq.com/s?__biz=MzU0NzYzMzU0Mw==&amp;mid=2247483722&amp;idx=1&amp;sn=46ae6dc8d24efd3abc5d43e7caec412a&amp;chksm=fb4a21a2cc3da8b43a52bd08c8170723fb38ddab27c836dad67c053551dde68151839e330ce2&amp;mpshare=1&amp;scene=1&amp;srcid=0430zsBdpZPJ1Qp7Cy46H8S4">Weblogic CVE-2019-2725 åˆ†ææŠ¥å‘Š-å»–æ–°å–œ</a></p>

<p>ä¸å–œæ¬¢çœ‹ä»£ç çš„å¯ä»¥çœ‹å®˜æ–¹å…³äºXMLDecoderçš„æ–‡æ¡£ï¼š
<a href="https://www.oracle.com/technetwork/java/persistence3-139471.html">Long Term Persistence of JavaBeans Components: XML Schema</a></p>

<h2 id="xmldecoderçš„å‡ ä¸ªå…³é”®ç±»">XMLDecoderçš„å‡ ä¸ªå…³é”®ç±»</h2>

<p>XMLDecoderçš„æ•´ä½“è§£æè¿‡ç¨‹æ˜¯åŸºäºJavaè‡ªå¸¦çš„SAX XMLè§£æè¿›è¡Œçš„ã€‚</p>

<p>ä»¥ä¸‹æ‰€æœ‰ç±»éƒ½åœ¨com.sun.beans.decoderåŒ…ä¸­</p>

<h3 id="documenthandler">DocumentHandler</h3>

<p>DocumentHandlerç»§æ‰¿è‡ªDefaultHandlerï¼ŒDefaultHandleræ˜¯ä½¿ç”¨SAXè¿›è¡ŒXMLè§£æçš„é»˜è®¤Handlerï¼Œæ‰€ä»¥Weblogicåœ¨å¯¹XMLå¯¹è±¡è¿›è¡Œvalidateçš„æ—¶å€™ä¹Ÿä½¿ç”¨äº†SAXï¼Œä¿è¯è¿‡ç¨‹çš„ä¸€è‡´æ€§ã€‚</p>

<p>DefaultHandlerå®ç°äº†EntityResolver, DTDHandler, ContentHandler, ErrorHandlerå››ä¸ªæ¥å£ã€‚</p>

<p>DocumentHandlerä¸»è¦æ”¹å†™äº†ContentHandlerä¸­çš„å‡ ä¸ªæ¥å£ï¼Œæ¯•ç«Ÿä¸»è¦æ˜¯é’ˆå¯¹å†…å®¹è¿›è¡Œè§£æçš„ï¼Œå…¶å®ƒçš„ä¿ç•™é»˜è®¤å°±å¥½ã€‚</p>

<h3 id="elementhandleråŠç›¸å…³ç»§æ‰¿ç±»">ElementHandleråŠç›¸å…³ç»§æ‰¿ç±»</h3>

<p>XMLDecoderå¯¹æ¯ç§æ”¯æŒçš„æ ‡ç­¾éƒ½å®ç°äº†ä¸€ä¸ªç»§æ‰¿ä¸ElementHandlerçš„ç±»ï¼Œå…·ä½“å¯ä»¥åœ¨DocumentHandlerçš„æ„é€ å‡½æ•°ä¸­çœ‹åˆ°ï¼š</p>

<p><img src="/images/XMLDecoder.asset/DocumentHandler_Constructor.png" alt="DocumentHandler_Constructor" /></p>

<p>æ‰€ä»¥XMLDecoderåªèƒ½ä½¿ç”¨å¦‚ä¸Šæ ‡ç­¾ã€‚</p>

<p>å…¶ä¸­ç»§æ‰¿å…³ç³»ä¸å‡½æ•°é‡å†™å…³ç³»å¦‚ä¸‹ï¼ˆå¾ˆå¤§ï¼Œå¯ä»¥çœ‹å¤§å›¾æˆ–è€…è‡ªå·±ç”¨ideaç”Ÿæˆå†çœ‹ï¼‰ï¼š</p>

<p><img src="/images/XMLDecoder.asset/ElementHandlers.png" alt="ElementHandlers" /></p>

<p>å¦‚ä¸Šçš„ç»§æ‰¿å…³ç³»ä¹Ÿæ˜¯objectæ ‡ç­¾å¯ä»¥ç”¨voidæ ‡ç­¾æ›¿ä»£ç”¨çš„åŸå› ï¼Œåé¢è¯¦è¯´ã€‚</p>

<h3 id="valueobjectåŠå…¶ç›¸å…³ç»§æ‰¿ç±»">ValueObjectåŠå…¶ç›¸å…³ç»§æ‰¿ç±»</h3>

<p>ValueObjectæ˜¯ä¸€ä¸ªåŒ…è£…ç±»æ¥å£ï¼ŒåŒ…è£¹äº†å®é™…è§£æè¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¯¹è±¡ï¼ˆåŒ…æ‹¬null)</p>

<p>ç»§æ‰¿å…³ç³»ï¼š</p>

<p><img src="/images/XMLDecoder.asset/ValueObject.png" alt="ValueObject" /></p>

<p>ä¸€èˆ¬çš„å¯¹åƒç”±ValueObjectImplè¿›è¡ŒåŒ…è£¹ï¼Œè€Œnull\true\falseï¼ˆébooleanæ ‡ç­¾ï¼‰åˆ™ç›´æ¥ç”±è‡ªèº«Handlerè¿›è¡Œä»£è¡¨ï¼Œå®ç°ç›¸å…³æ¥å£ã€‚</p>

<h2 id="xmldecoderè¿‡ç¨‹ä¸­çš„å‡ ä¸ªå…³é”®å‡½æ•°">XMLDecoderè¿‡ç¨‹ä¸­çš„å‡ ä¸ªå…³é”®å‡½æ•°</h2>

<p>DocumentHandlerçš„XMLè§£æç›¸å…³å‡½æ•°çš„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒJava Saxçš„<a href="https://docs.oracle.com/javase/7/docs/api/org/xml/sax/ContentHandler.html">ContentHandlerçš„æ–‡æ¡£</a>ã€‚</p>

<p>ElementHandlerç›¸å…³å‡½æ•°å¯ä»¥å‚è€ƒ<a href="[http://www.docjar.com/docs/api/com/sun/beans/decoder/ElementHandler.html](http://www.docjar.com/docs/api/com/sun/beans/decoder/ElementHandler.html)">ElementHandlerçš„æ–‡æ¡£</a>ã€‚</p>

<p>DocumentHandleråˆ›å»ºå„ä¸ªæ ‡ç­¾å¯¹åº”çš„ElementHandlerå¹¶è¿›è¡Œè°ƒç”¨ã€‚</p>

<h3 id="startelement">startElement</h3>

<p>å¤„ç†å¼€å§‹æ ‡ç­¾ï¼ŒåŒ…æ‹¬å±æ€§çš„æ·»åŠ 
<strong>DocumentHandler:</strong>ã€‚XMLè§£æå¤„ç†è¿‡ç¨‹ä¸­å‚æ•°åŒ…å«å‘½åç©ºé—´URLã€æ ‡ç­¾åã€å®Œæ•´æ ‡ç­¾åã€å±æ€§åˆ—è¡¨ã€‚æ ¹æ®å®Œæ•´æ ‡ç­¾ååˆ›å»ºå¯¹åº”çš„ElementHandlerå¹¶æ·»åŠ ç›¸å…³å±æ€§ï¼Œç»§ç»­è°ƒç”¨å…¶startElementã€‚</p>

<p><strong>ElementHandler:</strong> é™¤äº†arrayæ ‡ç­¾ä»¥å¤–ï¼Œéƒ½æ— æ“ä½œã€‚</p>

<h3 id="endelement">endElement</h3>

<p>ç»“æŸæ ‡ç­¾å¤„ç†å‡½æ•°
<strong>DocumentHandler:</strong> è°ƒç”¨å¯¹åº”ElementHandlerçš„endElementå‡½æ•°ï¼Œå¹¶å°†å½“å‰ElementHandlerå›æº¯åˆ°ä¸Šä¸€çº§çš„ElementHandlerã€‚</p>

<p><strong>ElementHandler:</strong> æ²¡çœ‹æœ‰é‡å†™çš„ï¼Œéƒ½æ˜¯è°ƒç”¨æŠ½è±¡ç±»ElementHandlerçš„endElementå‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å‘parentå†™å…¥å‚æ•°å’Œæ˜¯å¦éœ€è¦æ³¨å†Œæ ‡ç­¾å¯¹è±¡IDã€‚</p>

<h3 id="characters">characters</h3>

<p><strong>DocumentHandler:</strong> æ ‡ç­¾åŒ…è£¹çš„æ–‡æœ¬å†…å®¹å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚å¤„ç†<code>&lt;string&gt;java.lang.ProcessBuilder&lt;/string&gt;</code>åŒ…è£¹çš„æ–‡æœ¬å†…å®¹å°±ä¼šä»è¿™ä¸ªå‡½æ•°èµ°ã€‚å‡½æ•°ä¸­æœ€ç»ˆè°ƒç”¨äº†å¯¹åº”ElementHandlerçš„addCharacterå‡½æ•°ã€‚</p>

<h3 id="addcharacter">addCharacter</h3>

<p><strong>ElementHandler:</strong> ElementHandleré‡Œçš„addCharacteråªæ¥å—æ¥ç§ç©ºç™½å­—ç¬¦(ç©ºæ ¼\n\t\r)ï¼Œå…¶ä½™çš„ä¼šæŠ›å¼‚å¸¸ï¼Œè€ŒStringElementHandlerä¸­åˆ™è¿›è¡Œäº†é‡å†™ï¼Œä¼šè®°å½•å®Œæ•´çš„å­—ç¬¦ä¸²å€¼ã€‚</p>

<h3 id="addattribute">addAttribute</h3>

<p><strong>ElementHandler:</strong> æ·»åŠ å±æ€§ï¼Œæ¯ç§æ ‡ç­¾æ”¯æŒçš„ç›¸åº”çš„å±æ€§ï¼Œå‡ºç°å…¶ä½™å±æ€§ä¼šæŠ¥é”™ã€‚</p>

<h3 id="getcontextbean">getContextBean</h3>

<p><strong>ElementHandler:</strong> è·å–æ“ä½œå¯¹è±¡ï¼Œæ¯”å¦‚methodæ ‡ç­¾åœ¨æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œè¦ä»è·å–ä¸Šçº§object/void/newæ ‡ç­¾Handleræ‰€åˆ›å»ºçš„å¯¹è±¡ã€‚è¯¥æ–¹æ³•<strong>ä¸€èˆ¬</strong>ä¼šè§¦å‘ä¸Šä¸€çº§çš„getValueObjectæ–¹æ³•ã€‚</p>

<h3 id="getvalueobject">getValueObject</h3>

<p><strong>ElementHandler:</strong> è·å–å½“å‰æ ‡ç­¾æ‰€äº§ç”Ÿçš„å¯¹è±¡å¯¹åº”çš„ValueObjectå®ä¾‹ã€‚å…·ä½“å®ç°éœ€è¦çœ‹æ¯ä¸ªElementHandlerç±»ã€‚</p>

<h3 id="isargument">isArgument</h3>

<p><strong>ElementHandler:</strong> åˆ¤æ–­æ˜¯å¦ä¸ºä¸Šä¸€çº§æ ‡ç­¾Handlerçš„å‚æ•°ã€‚</p>

<h3 id="addargument">addArgument</h3>

<p><strong>ElementHandler:</strong> ä¸ºå½“å‰çº§æ ‡ç­¾Handleræ·»åŠ å‚æ•°ã€‚</p>

<h2 id="xmldecoderç›¸å…³çš„å…¶å®ƒ">XMLDecoderç›¸å…³çš„å…¶å®ƒ</h2>

<p>ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œåœ¨ç±»çš„å®ä¾‹åŒ–ä¹‹å‰ï¼Œé€šè¿‡å¯¹parentçš„è°ƒç”¨è¿›è¡Œå¢åŠ å‚æ•°ã€‚</p>

<h3 id="parent">parent</h3>

<p>æœ€å¤–å±‚æ ‡ç­¾çš„ElementHandlerçš„parentä¸ºnullï¼Œè€Œåä¾æ¬¡ä¸ºä¸Šä¸€çº§æ ‡ç­¾å¯¹åº”çš„ElementHandlerã€‚</p>

<h2 id="owner">owner</h2>

<p><strong>ElementHandler:</strong> å›ºå®šownerä¸ºæ‰€å±DocumentHandlerå¯¹è±¡ã€‚</p>

<p><strong>DocumentHandler:</strong> ownerå›ºå®šä¸ºæ‰€å±XMLDecoderå¯¹è±¡ã€‚</p>

<h2 id="ç®€æ˜“ç‰ˆè§£ææµç¨‹å›¾">ç®€æ˜“ç‰ˆè§£ææµç¨‹å›¾</h2>

<p>PPTç”»çš„:-D</p>

<p><img src="/images/XMLDecoder.asset/flowchart.png" alt="" /></p>

<h2 id="è·Ÿç€æ¼æ´æ¥æ³¢è·Ÿè¸ª-weblogic">è·Ÿç€æ¼æ´æ¥æ³¢è·Ÿè¸ª(Weblogic)</h2>

<p>æ¥ä¸€ä»½ç®€å•çš„ä»£ç ï¼š</p>

<pre><code class="language-java">public static void main(String[] args) throws FileNotFoundException {
    String filename = &quot;1.xml&quot;;
    XMLDecoder XD =new XMLDecoder(new FileInputStream(filename));
    Object o = XD.readObject();
    System.out.println(o);
}
</code></pre>

<h3 id="level1-ä»€ä¹ˆè¿‡æ»¤éƒ½æ²¡æœ‰">Level1:ä»€ä¹ˆè¿‡æ»¤éƒ½æ²¡æœ‰</h3>

<pre><code class="language-XML">&lt;java&gt;
    &lt;object class=&quot;java.lang.ProcessBuilder&quot;&gt;
        &lt;array class=&quot;java.lang.String&quot; length=&quot;1&quot;&gt;
            &lt;void index=&quot;0&quot;&gt;
                &lt;string&gt;calc&lt;/string&gt;
            &lt;/void&gt;
        &lt;/array&gt;
        &lt;void method=&quot;start&quot;/&gt;
    &lt;/object&gt;
&lt;/java&gt;
</code></pre>

<p>é¦–å…ˆçœ‹ä¸‹DocumentHandlerçš„startElement:
<img src="/images/XMLDecoder.asset/DocumentHandler_startElement.png" alt="" />
1. åˆ›å»ºå¯¹åº”Handlerï¼Œè®¾ç½®ownerä¸parent
2. ä¸ºHandleræ·»åŠ å±æ€§
3. è°ƒç”¨Handlerçš„startElement</p>

<p>(åé¢DocumentHandlerçš„éƒ¨åˆ†å¿½ç•¥ï¼Œç›´æ¥ä»ElementHandlerå¼€å§‹)
ä¸‹é¢ä»objectæ ‡ç­¾å¯¹åº”çš„ObjectElementHandlerå¼€å§‹çœ‹ï¼š
è¿›å…¥obejctæ ‡ç­¾ï¼Œobjectæ ‡ç­¾å¸¦æœ‰classå±æ€§ï¼Œè¿›å…¥ï¼š
<img src="/images/XMLDecoder.asset/ObjectElementHandler_addAttribute.png" alt="" />
å¯ä»¥çœ‹åˆ°åˆ¤æ–­çš„åˆ—è¡¨é‡Œæ²¡æœ‰classæ ‡ç­¾ï¼Œä¼šè°ƒç”¨çˆ¶ç±»(NewElementHandler)çš„addAttributeæ–¹æ³•ã€‚
<img src="/images/XMLDecoder.asset/NewElementHandler_addAttribute.png" alt="" />
ç»™typeèµ‹å€¼ä¸ºjava.lang.ProcessBuilderå¯¹åº”çš„Classå¯¹è±¡ã€‚</p>

<p>ä¸­é—´åˆ›å»ºarrayå‚æ•°çš„éƒ¨åˆ†ç•¥è¿‡ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è·Ÿä¸€ä¸‹ã€‚</p>

<p>è¿›å…¥voidæ ‡ç­¾ï¼Œè®¾ç½®å¥½methodå‚æ•°ï¼Œç”±äºç»§æ‰¿å…³ç³»ï¼Œçœ‹ä¸Šé¢é‚£å¼ addAttributeå›¾å°±å¥½ã€‚</p>

<p>é€€å‡ºvoidæ ‡ç­¾ï¼Œè¿›å…¥elementHandlerçš„endElementå‡½æ•°ï¼š
<img src="/images/XMLDecoder.asset/ElementHandler_endElement.png" alt="" /></p>

<p>ç”±äºç»§æ‰¿å…³ç³»ï¼Œè°ƒç”¨NewElementHandlerçš„getValueObjectå‡½æ•°ï¼š
<img src="/images/XMLDecoder.asset/NewElementHandler_getValueObject.png" alt="" /></p>

<p>ç»§ç»­è¿›å…¥è¿›å…¥ObjectElementHandlerçš„å¸¦å‚æ•°getValueObjectå‡½æ•°ï¼š
<img src="/images/XMLDecoder.asset/ObjectElementHandler_getValueObject.png" alt="" />
æ­¤å¤„çš„getContextBeanä¼šè°ƒç”¨ä¸Šä¸€çº§ä¹Ÿå°±æ˜¯Objectæ ‡ç­¾çš„getValueObjectæ¥è·å–æ“ä½œå¯¹è±¡ã€‚</p>

<p>ç•¥è¿‡ä¸­é—´æ­¥éª¤ï¼Œå†æ¬¡è¿›å…¥ObjectElementHandlerçš„getValueObjectæ–¹æ³•ï¼š</p>

<p>æœ€ç»ˆé€šè¿‡Expressionåˆ›å»ºäº†å¯¹è±¡ï¼š
<img src="/images/XMLDecoder.asset/Expression_new.png" alt="" />
(å¯ä»¥çœ‹å‡ºæ­¤å¤„çš„Expressionçš„é¦–ä¸ªå‚æ•°æ˜¯æ¥è‡ªäºä¸Šé¢getContextBeanè·å–çš„Classå¯¹è±¡ï¼Œå…ˆè®°ä½ï¼Œåé¢ä¼šç”¨)</p>

<p>å†æ¬¡å›åˆ°Voidæ ‡ç­¾å¯¹åº”çš„getValueObjectå‡½æ•°ï¼š
æœ€ç»ˆé€šè¿‡Expressionè°ƒç”¨äº†startå‡½æ•°ï¼š
<img src="/images/XMLDecoder.asset/Expression_start.png" alt="" /></p>

<p>å¦‚æœå¯¹ç»§æ‰¿å…³ç³»æ„Ÿè§‰æ¯”è¾ƒè’™çš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹ä¸€èŠ‚çš„ç»§æ‰¿å…³ç³»å›¾ã€‚</p>

<p><strong>PS:</strong> è™½ç„¶ObjectElementHandlerç»§æ‰¿è‡ªNewElementHandlerï¼Œä½†æ˜¯å…¶é‡å†™äº†getValueObjectå‡½æ•°ï¼Œä¸¤è€…æ˜¯ä½¿ç”¨ä¸åŒæ–¹æ³•åˆ›å»ºç±»çš„å®ä¾‹çš„ã€‚
<strong>å†PS:</strong> å…¶å®ä¸åŠ javaæ ‡ç­¾ä¹Ÿèƒ½ç”¨,ä½†æ˜¯æ²¡æ³•åŒ…å«å¤šä¸ªå¯¹è±¡äº†ã€‚</p>

<h3 id="level2-åªè¿‡æ»¤äº†objectæ ‡ç­¾">Level2:åªè¿‡æ»¤äº†objectæ ‡ç­¾</h3>

<p>æŠŠä¸Šé¢çš„objectæ ‡ç­¾æ›¿æ¢ä¸ºvoidå³å¯ã€‚</p>

<p>VoidElementHandlerçš„ç»§æ‰¿å…³ç³»ï¼š</p>

<p><img src="/images/XMLDecoder.asset/VoidElementHandler.png" alt="VoidElementHandler" /></p>

<p>å¯ä»¥çœ‹åˆ°åªæ”¹å†™äº†isArgument,è€Œåœ¨æ•´ä¸ªè§¦å‘è¿‡ç¨‹ä¸­å¹¶æ— å½±å“ï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨voidæ ‡ç­¾ä¸objectæ ‡ç­¾å®Œå…¨æ²¡æœ‰åŒºåˆ«ã€‚</p>

<h3 id="level3-è¿‡æ»¤ä¸€å †">Level3:è¿‡æ»¤ä¸€å †</h3>

<p>è¿‡æ»¤äº†object/new/methodæ ‡ç­¾ï¼Œvoidæ ‡ç­¾åªå…è®¸ç”¨indexï¼Œarrayçš„classåªèƒ½ç”¨byteï¼Œå¹¶é™åˆ¶äº†é•¿åº¦ã€‚</p>

<p>CNVD-2018-2725(CVE-2019-2725)æœ€åˆçš„pocä½¿ç”¨äº†UnitOfWorkChangeSetè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼ˆä»Badcodeå¸ˆå‚…çš„Paperé‡Œç›—çš„å›¾ï¼‰:</p>

<p><img src="/images/XMLDecoder.asset/UnitOfWorkChangeSet_Constructor.png" alt="UnitOfWorkChangeSet_Constructor" /></p>

<p>æœ€åˆçš„pocä¸»è¦åˆ©ç”¨<code>UnitOfWorkChangeSet</code>ç±»åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œä¼šå°†è¾“å…¥çš„byteæ•°ç»„çš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥è¯´åˆšå¼€å§‹è¯´æ˜¯ååºåˆ—åŒ–æ¼æ´ã€‚</p>

<p>å…¶å®è¿™ä¸ªæ´æ˜¯åˆ©ç”¨äº†å­˜åœ¨é—®é¢˜çš„ç±»çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºæ²¡æ³•ç”¨è°ƒç”¨methodäº†ï¼Œå°±å–äº†è¿™ç§æ¯”è¾ƒæŠ˜ä¸­çš„æ–¹æ³•ã€‚ï¼ˆå…¶å®è¿˜æ˜¯æœ‰éƒ¨åˆ†æ–¹æ³•å¯ä»¥è°ƒç”¨çš„:-Dï¼‰ã€‚</p>

<p>åœ¨åšè¿™ä¸ªå®éªŒæ—¶éœ€è¦å¯¼å…¥weblogic 10.3.6çš„modulesç›®å½•ä¸‹com.oracle.toplink_1.1.0.0_11-1-1-6-0.jaræ–‡ä»¶ã€‚</p>

<pre><code class="language-XML">&lt;java&gt;
    &lt;class&gt;&lt;string&gt;oracle.toplink.internal.sessions.UnitOfWorkChangeSet&lt;/string&gt;&lt;void&gt;
            &lt;array class=&quot;byte&quot; length=&quot;2&quot;&gt;
                &lt;void index=&quot;0&quot;&gt;
                    &lt;byte&gt;-84&lt;/byte&gt;
                &lt;/void&gt;
                &lt;void index=&quot;0&quot;&gt;
                    &lt;byte&gt;-19&lt;/byte&gt;
                &lt;/void&gt;
            &lt;/array&gt;
        &lt;/void&gt;
    &lt;/class&gt;
&lt;/java&gt; 
</code></pre>

<p>ç”±äºclassæ ‡ç­¾ç»§æ‰¿äº†ç»§æ‰¿äº†stringæ ‡ç­¾çš„<code>addCharacter</code>å‡½æ•°ï¼Œå¯¼è‡´å…¶ä¼šå°†æ ‡ç­¾ä¸­åŒ…è£¹çš„ç©ºç™½å­—ç¬¦(ç©ºæ ¼\r\n\t)ä¹ŸåŠ å…¥åˆ°classnameä¸­ï¼Œå¯¼è‡´æ‰¾classå¤±è´¥ï¼Œæ‰€ä»¥è‡³å°‘è¦å°†&lt;class&gt;åˆ°&lt;void&gt;ä¹‹é—´çš„ç©ºç™½å­—ç¬¦åˆ é™¤ã€‚</p>

<p><strong>PSï¼š</strong> å…¶å®è¿™é‡Œä¸åŠ stringæ ‡ç­¾ä¹Ÿæ²¡é—®é¢˜ã€‚</p>

<p>Level1ä¸­è¯´åˆ°ï¼š
&gt; Expressionçš„é¦–ä¸ªå‚æ•°æ˜¯æ¥è‡ªäºä¸Šé¢getContextBeanè·å–çš„Classå¯¹è±¡</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœèƒ½å¤Ÿæ‰¾åˆ°æ›¿ä»£ä¸Šé¢object/void+classå±æ€§çš„æ–¹æ³•ä»¤getContextBeanå¯ä»¥è·å–åˆ°Classå¯¹è±¡ï¼Œä¹Ÿä¹…å¯ä»¥è°ƒç”¨æ„é€ å‡½æ•°è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºã€‚</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸‹æ­¤å¤„è°ƒç”¨çš„getContextBeançš„å®ç°ï¼š
<img src="/images/XMLDecoder.asset/NewElementHandler_getContextBean.png" alt="UnitOfWorkChangeSet_Constructor" /></p>

<p>Level1/2ä¸­ç”±äºObject(Void)è®¾ç½®äº†classå±æ€§ï¼Œé‚£ä¹ˆtypeæ˜¯æœ‰å€¼çš„ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›typeã€‚</p>

<p>è€Œçˆ¶ç±»çš„getContextBeanæ˜¯è°ƒç”¨parentçš„getValueObjectå‡½æ•°ï¼Œæ¥è·å–ä¸Šä¸€çº§å¯¹è±¡ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬ä»¤ä¸Šä¸€çº§è·å–åˆ°çš„å¯¹è±¡ä¸ºClasså³å¯ï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨äº†classæ ‡ç­¾ä»¤voidçš„ä¸Šä¸€çº§è·å–çš„å¯¹è±¡ä¸ºClasså¯¹è±¡ã€‚</p>

<p>å› ä¸ºvoidæ ‡ç­¾åªå…è®¸ä½¿ç”¨indexå±æ€§ï¼Œæ‰€ä»¥æ­¤å¤„æ— æ³•ä½¿ç”¨methodå±æ€§æ¥è°ƒç”¨å…·ä½“å‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½å¯„æœŸæœ›äºæ„é€ æ–¹æ³•ï¼Œå°±æœ‰äº†ä¸Šé¢åˆ©ç”¨UnitOfWorkChangeSetç±»çš„æ„é€ æ–¹æ³•æ¥åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„æ‰‹æ³•ã€‚</p>

<p>åŒæ ·å¯åˆ©ç”¨çš„ç±»è¿˜æœ‰ä¹‹å‰<a href="https://github.com/irsl/jackson-rce-via-spel/">jackson rce</a>ç”¨çš„FileSystemXmlApplicationContextç±»ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>XMLDecoderçš„æµç¨‹è¿˜æ˜¯è›®æœ‰æ„æ€çš„ï¼Œå…·ä½“å„æ ‡ç­¾çš„åŠŸèƒ½ã€è¯¦ç»†è§£ææµç¨‹ï¼Œè¿˜éœ€è¦å¤§å®¶è‡ªå·±çœ‹ä¸€ä¸‹ã€‚</p>

<p>é¡ºä¾¿é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼š
ä¸€å®šè¦è‡ªå·±è·Ÿä¸€ä¸‹ï¼
ä¸€å®šè¦è‡ªå·±è·Ÿä¸€ä¸‹ï¼
ä¸€å®šè¦è‡ªå·±è·Ÿä¸€ä¸‹ï¼</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/2018/11/20/hm_new_version150.html"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/2018/11/20/hm_new_version150.html">æ²³é©¬WEBSHELLæ‰«æå™¨1.5.0å‘å¸ƒ</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/2019/05/21/cve-2019-0708_warning_fix.html">CVE-2019-0708æ¼æ´é¢„è­¦åŠä¿®å¤å»ºè®® é™„POC</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/2019/05/21/cve-2019-0708_warning_fix.html"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
  
  
  
  ï»¿

<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTUxNC82MDgy">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
</div>



</div>

</div>
</div>
<script src="js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

